<section class="admin-user-info">
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-content">
        <div class="header-text">
          <h1 class="page-title">
            <i class="fas fa-user-circle"></i>
            User Information
          </h1>
          <p class="page-subtitle">Comprehensive details for {{ user()?.name || user()?.email }}</p>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" routerLink="/admin/orders">
            <i class="fas fa-arrow-left"></i>
            Back to Orders
          </button>
        </div>
      </div>
    </div>

    @if (user(); as user) {
      <!-- User Overview Cards -->
      <div class="overview-cards">
        <div class="overview-card user-stats">
          <div class="card-icon">
            <i class="fas fa-shopping-cart"></i>
          </div>
          <div class="card-content">
            <h3>{{ orders().length }}</h3>
            <p>Total Orders</p>
          </div>
        </div>
        <div class="overview-card transaction-stats">
          <div class="card-icon">
            <i class="fas fa-credit-card"></i>
          </div>
          <div class="card-content">
            <h3>{{ transactions().length }}</h3>
            <p>Total Transactions</p>
          </div>
        </div>
        <div class="overview-card revenue-stats">
          <div class="card-icon">
            <i class="fas fa-rupee-sign"></i>
          </div>
          <div class="card-content">
            <h3>{{ totalSpent() | currency:'INR':'symbol':'1.2-2' }}</h3>
            <p>Total Spent</p>
          </div>
        </div>
      </div>

      <!-- Main Content Grid -->
      <div class="content-grid">
        <!-- User Details Card -->
        <div class="main-card user-details-card">
          <div class="card-header">
            <h2 class="card-title">
              <i class="fas fa-id-card"></i>
              User Details
            </h2>
          </div>
          <div class="card-body">
            <div class="user-avatar">
              <div class="avatar-circle">
                <i class="fas fa-user"></i>
              </div>
            </div>
            <div class="user-info-grid">
              <div class="info-item">
                <label>User ID</label>
                <span class="info-value">{{ user.id }}</span>
              </div>
              <div class="info-item">
                <label>Full Name</label>
                <span class="info-value">{{ user.name }}</span>
              </div>
              <div class="info-item">
                <label>Email Address</label>
                <span class="info-value">{{ user.email }}</span>
              </div>
              <div class="info-item">
                <label>Role</label>
                <span class="info-value role-badge" [class]="'role-' + user.role.toLowerCase()">
                  {{ user.role | titlecase }}
                </span>
              </div>
              <div class="info-item">
                <label>Member Since</label>
                <span class="info-value">{{ user.createdAt | date:'mediumDate' }}</span>
              </div>
              <div class="info-item">
                <label>Account Age</label>
                <span class="info-value">{{ accountAge() }} days</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Combined Order History & Transactions Card -->
        <div class="main-card orders-transactions-card">
          <div class="card-header">
            <h2 class="card-title">
              <i class="fas fa-history"></i>
              Order History & Transactions
            </h2>
            <span class="card-count">{{ orders().length }} orders, {{ transactions().length }} transactions</span>
          </div>
          <div class="card-body">
            @if (orders().length === 0) {
              <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <h3>No Orders Yet</h3>
                <p>This user hasn't placed any orders.</p>
              </div>
            } @else {
              <div class="orders-transactions-list">
                @for (order of orders(); track order.id) {
                  <div class="order-transaction-group" [class]="'order-' + order.status">
                    <!-- Order Header -->
                    <div class="order-header-section">
                      <div class="order-main-info">
                        <div class="order-id">
                          <a [routerLink]="['/order', order.id, { from: 'admin-user' }]" class="order-link">
                            <i class="fas fa-hashtag"></i>
                            {{ order.id }}
                          </a>
                        </div>
                        <div class="order-status">
                          <span class="status-badge" [class]="'status-' + order.status">
                            <i class="fas" [class]="getStatusIcon(order.status)"></i>
                            {{ order.status | titlecase }}
                          </span>
                        </div>
                      </div>
                      <div class="order-summary-info">
                        <div class="order-meta">
                          <span class="order-date">
                            <i class="fas fa-calendar"></i>
                            {{ order.createdAt | date:'short' }}
                          </span>
                          <span class="order-items">
                            <i class="fas fa-box"></i>
                            {{ order.items.length }} item{{ order.items.length !== 1 ? 's' : '' }}
                          </span>
                        </div>
                        <div class="order-total">
                          <span class="amount">{{ order.total | currency:'INR':'symbol':'1.2-2' }}</span>
                        </div>
                      </div>
                    </div>

                    <!-- Order Transactions -->
                    <div class="order-transactions-section">
                      <div class="transactions-header">
                        <h5>Transactions for this Order</h5>
                        <span class="transaction-count">{{ getOrderTransactions(order.id).length }}</span>
                      </div>
                      @if (getOrderTransactions(order.id).length === 0) {
                        <div class="no-transactions">
                          <i class="fas fa-info-circle"></i>
                          No transactions recorded for this order
                        </div>
                      } @else {
                        <div class="order-transactions-grid">
                          @for (tx of getOrderTransactions(order.id); track tx.id) {
                            <div class="transaction-mini-card" [class]="'tx-' + tx.status">
                              <div class="transaction-icon">
                                <i class="fas" [class]="getTransactionIcon(tx.method)"></i>
                              </div>
                              <div class="transaction-content">
                                <div class="transaction-id">{{ tx.id }}</div>
                                <div class="transaction-details">
                                  <span class="transaction-method">{{ tx.method | titlecase }}</span>
                                  <span class="transaction-date">{{ tx.createdAt | date:'short' }}</span>
                                </div>
                                <div class="transaction-status" [class]="'status-' + tx.status">
                                  {{ tx.status | titlecase }}
                                </div>
                              </div>
                              <div class="transaction-amount">
                                <span class="amount" [class]="tx.status === 'refunded' ? 'refund-amount' : 'paid-amount'">
                                  {{ tx.status === 'refunded' ? '-' : '' }}{{ tx.amount | currency:'INR':'symbol':'1.2-2' }}
                                </span>
                              </div>
                            </div>
                          }
                        </div>
                      }
                    </div>

                    @if (order.status === 'delivered' && order.delivered_on) {
                      <div class="order-delivery">
                        <i class="fas fa-check-circle"></i>
                        Delivered on {{ order.delivered_on | date:'mediumDate' }}
                      </div>
                    }
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </div>
    } @else {
      <div class="loading-state">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
        <h3>Loading User Information...</h3>
        <p>Please wait while we fetch the user details.</p>
      </div>
    }
  </div>
</section>
